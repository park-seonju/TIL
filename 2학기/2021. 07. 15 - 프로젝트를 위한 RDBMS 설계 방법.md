## 2021. 07. 15 - 프로젝트를 위한 RDBMS 설계 방법

### DB 설계의 목적

- 프로젝트, 명세서 등의 정보 요구사항에 대한 정확한 이해
- 분석자, 개발자, 사용자 간의 원활한 의사소통 수단
- 데이터 중심의 분석 방법
- 현행 시스템만이 아닌 신규 시스템 개발의 기초 제공
- 설계를 대충 하면 기능 한 개 추가될 때마다 DB와 관련된 이미 개발된 프로그램도 함께 뜯어고쳐야 하는 경우가 발생한다.

#### 설계를 위한 요구사항 분석

- DB에 대한 사용자의 요구사항을 수집, 분석, 아래와 같이 문장 형태로 요구사항(기능) 명세서 작성
  - `요구사항 명세 샘플 - 항공사 DB 회원으로 가입하려면 ID, 비밀번호, 성명, 신용카드 정보를 입력해야 한다. 회원의 신용카드 정보는 여러 개를 저장할 수 있다. 신용카드번호, 유효기간을 저장할 수 있다. 회사가 보유한 비행기에 대해 비행기 번호, 출발 날짜, 출발 시간 정보를 저장하고 있다. 비행기 좌석에 대한 좌석 번호, 등급 정보를 저장하고 있다. 회원은 좌석을 예약하는데, 회원 1명은 좌석을 하나만 예약할 수 있고, 한 좌석은 회원 한 명만 예약할 수 있다.`

#### 개념적 설계

- 작성한 요구사항 명세서에서 DB 구성에 필요한 개체, 속성, 개체 간의 관계를 추출, ERD 생성개체(entity)와 속성(attribute) 추출 - 대부분 명사로 선별요구사항에서 개체는 대부분 명사로 이루어져있으나, 속성과 구별하여 추출위 명세에서 회원, 신용카드, 비행기, 좌석은 개체아이디, 비밀번호, 성명, 카드번호, 유효기간, 비행기 번호, 출발 날짜, 출발 시간, 좌석번호, 등급 등은 속성필요하다고 생각되는 것들.개체 간의 관계(relationship)을 추출 - 대부분 동사로 선별, 개체 간의 관계를 나타내는 동사여러 가지로 분류해서 정의.관계에 속한 속성, 1:1 / 1:N / N:M, 필수적/선택적 참여...회원 - 신용카드 정보: 여러 개를 저장 (1:N)회원 한 명은 좌석을 하나만 예약 가능, 한 좌석은 회원 한 명만 예약 가능 (1:1)개념 설계 기반으로 ERD 생성□ 개체, ○ 속성, ◇ 관계1:1, 1:N, N:M도 반영

#### 논리적 설계

1. 개체 -> 릴레이션(Table)개체 -> 테이블 / 속성 -> 테이블의 속성
2. N:M 관계 -> 릴레이션(Table)관계 -> 릴레이션명 / 관계속성 -> 릴레이션 속성N:M 관계에서는 바로 연결할 수 없으므로 테이블을 추가 생성
3. 1:N, 1:1 관계 -> 외래키(Foreign Key)일반적으로 1:N 관계에서 하나만 있는 쪽의 기본키를 N쪽 릴레이션에 포함, FK로 지정일반적 1:1 관계는 FK를 서로 주고 받음. 양쪽 모두에 FK 추가.
4. 다중 값 속성 -> 독립 릴레이션(Table)릴레이션에서는 다중 값 속성을 가질 수 없음 -> 다중 값 속성은 별도의 릴레이션으로 생성참고: 제 1 정규화는 다중값을 갖는 속성이 있을 때, 한 속성이 원자값(하나의 값)을 갖도록 변경ex) 사원 릴레이션 -> 자녀 릴레이션을 별도로 생성, 사원번호(FK), 자녀명 으로 구성

#### 물리적 스키마 및 구현

- ERD를 실제 테이블로 생성: Workbench 같은 DB Tool, SQL 스크립트 모두 가능해야 함.실무에서 CLI에서 DB 생성하는 경우 있음.

### 반정규화

- 정규화된 엔티티타입, 속성, 관계를 시스템 성능 향상, 개발과 운영 단순화를 위해 모델을 통합하는 프로세스
- 정규화 모델이상적인 논리 모델 -> 여러 테이블을 join해서 사용 -> SQL 작성이 어렵고, 테이블 join 과다로 성능 저하 가능성
- 반정규화 모델성능을 위해 원칙을 의도적으로 어기기.같은 데이터가 여러 테이블에 존재 -> 무결성 깨질 우려 존재.

#### 테이블 반정규화 방법

- 1:1 관계의 테이블 병합
- 1:N 관계의 테이블 병합
- 슈퍼/서브 타입 테이블 병합
- 수직 분할(집중화된 일부 컬럼 분리)
- 수평 분할(행으로 구분, 구간별 분리)
- 테이블 추가 (중복테이블, 통계테이블, 이력테이블, 부분테이블)

#### 대표적 반정규화 - 컬럼 반정규화

- 중복 컬럼 추가: 자주 조회하는 컬럼이 있는 경우영업사원이 속한 지점 위치 등.
- 파생 컬럼 추가: 미리 계산한 값
- PK에 의한 컬럼 추가
- 응용 시스템 오작동을 위한 컬럼 추가: 이전 데이터 임시 보관

#### 대표적 반정규화 - 관계 반정규화

- 중복 관계 추가: A테이블에서 C 테이블 정보를 읽을 수 있는 관계(다수의 join)가 있어도, 관계를 중복하여 조회(read) 경로를 단축성능 면에서 꼭 필요한 경우에.

#### 정규화 vs 반정규화

- 정답 X. 그 때 그 때 다름. 개념을 잘 알고 있어야 적절히 활용 가능.

### Q&A

- NoSQL 설계: RDBMS와 방식 다름.
- 정규화 단계 적용: 실무에서는 제 3 정규화까지 일반적으로 사용. 빅데이터 등 대량의 데이터 등장으로 반정규화 사용 비일비재.
- ERD 작성: 메인 설계자 + 여럿이서 토의하면서 구조 결정하는 게 좋을 듯.
- 1:1 관계에서 FK는 아무 데나 써도 되지만, 외부에서 테이블명을 볼 때 혼동이 없도록 판단 필요.